<!-- user.html -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Users</title>
    <style>
      body {
        font-family: Arial;
        padding: 20px;
        background: #f4f4f4;
      }
      h1 {
        text-align: center;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
        background: white;
      }
      th,
      td {
        padding: 10px;
        border: 1px solid #ccc;
      }
      th {
        background: #28a745;
        color: white;
      }
      tr:nth-child(even) {
        background: #f9f9f9;
      }
      .container {
        max-width: 900px;
        margin: auto;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Users</h1>
      <button onclick="openModal()">Add User</button>
      <table id="usersTable">
        <thead>
          <tr id="userHeaderRow"></tr>
        </thead>
        <tbody id="userTableBody"></tbody>
      </table>
    </div>

    <script>
      fetch("http://localhost:3001/users")
        .then((res) => res.json())
        .then((data) => {
          if (!data.success) return alert("Failed to load users");
          const rows = data.users;
          if (rows.length === 0) return;

          const headerRow = document.getElementById("userHeaderRow");
          const tableBody = document.getElementById("userTableBody");

          const headers = Object.keys(rows[0]);
          headers.forEach((h) => {
            const th = document.createElement("th");
            th.textContent = h;
            headerRow.appendChild(th);
          });

          rows.forEach((row) => {
            const tr = document.createElement("tr");
            headers.forEach((h) => {
              const td = document.createElement("td");
              td.textContent = row[h];
              tr.appendChild(td);
            });
            tableBody.appendChild(tr);
          });
        });
    </script>
  </body>
  <!-- Add User Popup for user.html -->
  <div
    id="addUserModal"
    style="
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      justify-content: center;
      align-items: center;
    "
  >
    <div
      style="
        background: white;
        padding: 20px;
        border-radius: 10px;
        width: 350px;
      "
    >
      <h3>Add User</h3>
      <label>USERID</label
      ><input id="userid" style="width: 100%; margin-bottom: 10px" />
      <label>Full Name</label
      ><input id="fullname" style="width: 100%; margin-bottom: 10px" />
      <label>Email</label
      ><input id="email" style="width: 100%; margin-bottom: 10px" />
      <label>Password</label
      ><input
        id="password"
        type="password"
        style="width: 100%; margin-bottom: 10px"
      />
      <label>Address</label
      ><input id="address" style="width: 100%; margin-bottom: 10px" />
      <button onclick="submitUser()">Submit</button>
      <button onclick="closeModal()">Cancel</button>
    </div>
  </div>

  <script>
    function openModal() {
      document.getElementById("addUserModal").style.display = "flex";
    }
    function closeModal() {
      document.getElementById("addUserModal").style.display = "none";
    }

    function submitUser() {
      const data = {
        USERID: document.getElementById("userid").value,
        FULLNAME: document.getElementById("fullname").value,
        EMAIL: document.getElementById("email").value,
        PASSWORD: document.getElementById("password").value,
        ADDRESS: document.getElementById("address").value,
      };

      fetch("http://localhost:3001/addUser", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data),
      })
        .then((r) => r.json())
        .then((res) => {
          if (res.success) {
            alert("User Added");
            location.reload();
          } else alert(res.message);
        });
    }
  </script>
</html>
