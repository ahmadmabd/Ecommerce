<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Users</title>

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
    />

    <style>
      body {
        background: #e3eef9; /* light blue */
      }

      /* Header row */
      #userHeaderRow {
        background-color: #2d5983;
        color: white;
      }

      /* All data rows white */
      #userTableBody tr {
        background-color: white !important;
        transition: background-color 0.2s ease;
      }

      /* SIMPLER, CLEANER HOVER */
      #userTableBody tr:hover {
        background-color: #f2f7fc !important; /* soft highlight */
        transform: none;
        box-shadow: none;
      }

      .btn-add-user {
        background: #2d5983;
        color: white;
        border-radius: 50px;
        display: flex;
        align-items: center;
        gap: 10px;
        padding-right: 18px;
        font-weight: 500;
        transition: 0.3s ease;
      }

      /* Hover becomes WHITE */
      .btn-add-user:hover {
        background: white;
        color: #2d5983;
      }

      /* Make the + circle invert colors when hovered */
      .btn-add-user:hover .plus-circle {
        background: #2d5983;
        color: white;
      }

      .plus-circle {
        width: 28px;
        height: 28px;
        border-radius: 50%;
        background: white;
        color: #2d5983;
        display: flex;
        justify-content: center;
        align-items: center;
        font-weight: bold;
        font-size: 24px;
        padding-bottom: 5px;
        transition: 0.3s ease;
      }

      .profile-label {
        color: #2d5983;
      }
      .profile-input {
        background: #e6f2ff;
        border: 2px solid #2d5983;
        color: #2d5983;
      }

      .btn-eye {
        transition: transform 0.2s;
      }
      .btn-eye:hover {
        transform: scale(1.15);
      }
    </style>
  </head>

  <body>
    <!-- Inlined navbar (from nav_bar.html) -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
    <style>
      :root {
        --bg: #2d5983; /* navbar background primary */
        --primary: #2d5983;
        --secondary: #499aac; /* for highlights, badge, sign up text */
        --card-radius: 12px;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #c5d7df, #eef6fa);
        min-height: 100vh;
        color: #203040;
      }

      /* NAVBAR */
      .navbar {
        background: var(--bg);
        box-shadow: 0 6px 18px rgba(45, 89, 131, 0.18);
        position: sticky;
        top: 0;
        z-index: 50;
      }

      .navbar-container {
        max-width: 1200px;
        margin: auto;
        padding: 12px 20px;
        display: flex;
        gap: 16px;
        align-items: center;
        justify-content: space-between;
      }

      /* LOGO */
      .logo {
        display: flex;
        gap: 10px;
        align-items: center;
        font-weight: 800;
        color: #fff; /* logo white */
        font-size: 20px;
        user-select: none;
      }
      .logo i {
        font-size: 26px;
        transform: translateY(-2px);
      }

      /* LINKS - desktop */
      .nav-links {
        list-style: none;
        display: flex;
        gap: 26px;
        align-items: center;
      }
      .nav-links li {
        position: relative;
      }
      .nav-links a {
        text-decoration: none;
        color: #fff; /* links white */
        font-weight: 600;
        padding: 8px 0;
        display: inline-block;
        transition: transform 0.18s ease, color 0.18s ease;
      }
      .nav-links a::after {
        content: "";
        position: absolute;
        left: 0;
        bottom: -6px;
        width: 0;
        height: 3px;
        background: var(--secondary); /* underline secondary */
        border-radius: 3px;
        transition: width 0.28s cubic-bezier(0.2, 0.9, 0.2, 1);
      }
      .nav-links a:hover,
      .nav-links a.active {
        color: #fff;
      }
      .nav-links a:hover::after,
      .nav-links a.active::after {
        width: 100%;
      }

      /* dropdown */
      .dropdown {
        cursor: pointer;
        padding: 6px 8px;
        border-radius: 8px;
      }
      .dropdown-menu {
        position: absolute;
        top: calc(100% + 8px);
        left: 0;
        min-width: 160px;
        background: white;
        border-radius: 10px;
        box-shadow: 0 12px 30px rgba(20, 40, 60, 0.12);
        overflow: hidden;
        opacity: 0;
        transform: translateY(6px) scale(0.98);
        transform-origin: top left;
        transition: opacity 0.18s ease, transform 0.18s ease;
        pointer-events: none;
        z-index: 40;
      }
      .dropdown:hover .dropdown-menu,
      .dropdown:focus-within .dropdown-menu {
        opacity: 1;
        transform: translateY(0) scale(1);
        pointer-events: auto;
      }
      .dropdown-menu a {
        display: block;
        padding: 10px 12px;
        color: #213240;
        text-decoration: none;
        font-weight: 600;
      }
      .dropdown-menu a:hover {
        background: rgba(0, 0, 0, 0.04);
      }

      /* auth buttons */
      .auth-buttons {
        display: flex;
        gap: 12px;
        align-items: center;
      }
      .btn {
        padding: 10px 22px;
        font-weight: 700;
        border-radius: 999px;
        cursor: pointer;
        border: 2px solid transparent;
        transition: transform 0.12s ease, box-shadow 0.12s ease,
          background 0.3s ease, color 0.3s ease, background-position 0.3s ease;
        user-select: none;
        background-size: 200% 200%;
      }

      .btn:active {
        transform: translateY(1px) scale(0.995);
      }

      /* Sign In button: gradient animation on hover */
      .btn-signin {
        background: linear-gradient(45deg, var(--primary), #1f4567);
        color: #fff;
        border-color: var(--primary);
        box-shadow: 0 6px 18px rgba(45, 89, 131, 0.08);
      }
      .btn-signin:hover {
        background-position: right center;
        box-shadow: 0 10px 28px rgba(45, 89, 131, 0.14);
      }

      /* Sign Up button: background white, text secondary, gradient on hover */
      .btn-signup {
        background: #fff;
        color: var(--secondary);
        box-shadow: 0 6px 18px rgba(45, 89, 131, 0.08);
        border-color: rgba(255, 255, 255, 0.06);
      }
      .btn-signup:hover {
        background: linear-gradient(90deg, #fff, #eef6fa);
        color: var(--secondary);
        box-shadow: 0 10px 28px rgba(45, 89, 131, 0.1);
      }

      /* small badge next to signup */
      .btn-signup .badge {
        background: var(--secondary); /* badge "New" */
        color: white;
        font-size: 12px;
        padding: 4px 8px;
        border-radius: 999px;
        margin-left: 8px;
        font-weight: 800;
      }

      /* hamburger (mobile) */
      .hamburger {
        display: none;
        width: 44px;
        height: 44px;
        border-radius: 10px;
        background: rgba(255, 255, 255, 0.85);
        align-items: center;
        justify-content: center;
        box-shadow: 0 6px 18px rgba(20, 40, 60, 0.06);
        cursor: pointer;
        border: 1px solid rgba(0, 0, 0, 0.04);
      }
      .hamburger i {
        font-size: 20px;
        color: #fff;
      }

      /* mobile menu */
      .mobile-menu {
        display: none;
        background: linear-gradient(180deg, rgba(255, 255, 255, 0.95), white);
        box-shadow: 0 14px 40px rgba(20, 40, 60, 0.08);
        border-top: 1px solid rgba(0, 0, 0, 0.03);
      }
      .mobile-menu.open {
        display: block;
      }
      .mobile-links {
        list-style: none;
        padding: 12px 18px;
        display: flex;
        flex-direction: column;
        gap: 8px;
      }
      .mobile-links a {
        padding: 10px;
        border-radius: 8px;
        text-decoration: none;
        color: var(--secondary);
        font-weight: 700;
      }
      .mobile-links a:hover {
        background: rgba(0, 0, 0, 0.03);
      }

      @media (max-width: 900px) {
        .nav-links {
          display: none;
        }
        .hamburger {
          display: flex;
        }
        .auth-buttons {
          display: none;
        }
      }

      /* content box */
      .page-content {
        max-width: 1200px;
        margin: 36px auto;
        padding: 28px;
        background: white;
        border-radius: var(--card-radius);
        box-shadow: 0 12px 36px rgba(45, 89, 131, 0.12);
      }
    </style>

    <nav class="navbar">
      <div class="navbar-container">
        <!-- LOGO -->
        <div
          class="logo"
          onclick="location.href='home.html'"
          style="cursor: pointer"
        >
          <i class="fa-solid fa-boxes-stacked"></i>
          <span>StockManager</span>
        </div>

        <!-- desktop links -->
        <ul class="nav-links" role="menubar">
          <li><a href="home.html" data-page="home">Home</a></li>
          <li class="dropdown" tabindex="0">
            <a class="dropdown-toggle" data-page="products"
              >Products
              <i
                class="fa-solid fa-caret-down"
                style="font-size: 12px; margin-left: 6px; color: #fff"
              ></i
            ></a>
            <div class="dropdown-menu" role="menu" aria-hidden="true">
              <a href="products.html" data-page="products">All Products</a>

              <a href="categories.html" data-page="categories">Categories</a>
            </div>
          </li>
          <li><a href="dashboard.html" data-page="dashboard">Dashboard</a></li>
          <li><a href="users.html" data-page="users">Users</a></li>
          <li><a href="orders.html" data-page="orders">Orders</a></li>
        </ul>

        <!-- auth + hamburger -->
        <div style="display: flex; align-items: center; gap: 12px">
          <div class="auth-buttons">
            <button
              class="btn btn-signin"
              onclick="location.href='sign-in.html'"
            >
              Sign In
            </button>
            <button
              class="btn btn-signup"
              onclick="location.href='signup.html'"
            >
              Sign Up <span class="badge">New</span>
            </button>
          </div>

          <button class="hamburger" aria-label="Toggle menu" id="hambtn">
            <i class="fa-solid fa-bars"></i>
          </button>
        </div>
      </div>

      <!-- Mobile menu -->
      <div class="mobile-menu" id="mobileMenu" aria-hidden="true">
        <ul class="mobile-links">
          <li><a href="home.html">Home</a></li>
          <li><a href="dashboard.html">Dashboard</a></li>
          <li><a href="products.html">Products</a></li>

          <li><a href="users.html">Users</a></li>
          <li><a href="orders.html">Orders</a></li>
          <li
            style="padding-top: 8px; border-top: 1px solid rgba(0, 0, 0, 0.04)"
          >
            <a href="sign-in.html">Sign In</a>
          </li>
          <li><a href="sign-up.html">Sign Up</a></li>
        </ul>
      </div>
    </nav>

    <script>
      // Set active navbar link based on current page
      (function setActiveNavLink() {
        const currentPage =
          window.location.pathname.split("/").pop() || "home.html";
        document.querySelectorAll(".nav-links a[data-page]").forEach((link) => {
          if (currentPage.includes(link.getAttribute("data-page"))) {
            link.classList.add("active");
          }
        });
      })();

      const btn = document.getElementById("hambtn");
      const menu = document.getElementById("mobileMenu");
      let open = false;
      if (btn) {
        btn.addEventListener("click", () => {
          open = !open;
          menu.classList.toggle("open", open);
          menu.setAttribute("aria-hidden", !open);
          const i = btn.querySelector("i");
          if (i) {
            i.classList.toggle("fa-bars", !open);
            i.classList.toggle("fa-xmark", open);
          }
        });

        document.querySelectorAll(".mobile-links a").forEach((a) => {
          a.addEventListener("click", () => {
            open = false;
            menu.classList.remove("open");
            menu.setAttribute("aria-hidden", "true");
            const i2 = btn.querySelector("i");
            if (i2) {
              i2.classList.remove("fa-xmark");
              i2.classList.add("fa-bars");
            }
          });
        });

        document.querySelectorAll(".dropdown").forEach((el) => {
          el.addEventListener("keydown", (e) => {
            if (e.key === "Enter" || e.key === " ") {
              e.preventDefault();
              const first = el.querySelector(".dropdown-menu a");
              if (first) first.focus();
            }
          });
        });
      }
    </script>

    <div class="container mt-4">
      <h1 class="text-center mb-4" style="color: #2d5983">Users</h1>

      <div class="d-flex justify-content-end mb-3">
        <button
          class="btn btn-add-user"
          data-bs-toggle="modal"
          data-bs-target="#addUserModal"
        >
          Add User
          <span class="plus-circle">+</span>
        </button>
      </div>

      <div class="table-responsive">
        <table
          class="table table-hover table-bordered shadow-sm align-middle"
          id="usersTable"
        >
          <thead class="table-dark">
            <tr id="userHeaderRow"></tr>
          </thead>
          <tbody id="userTableBody"></tbody>
        </table>
      </div>
    </div>

    <!-- Add User Modal -->
    <div class="modal fade" id="addUserModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header" style="background: #2d5983; color: white">
            <h5 class="modal-title">Add User</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>

          <div class="modal-body">
            <div class="mb-3">
              <label class="form-label">Full Name</label>
              <input id="fullname" class="form-control" />
            </div>
            <div class="mb-3">
              <label class="form-label">Email</label>
              <input id="email" class="form-control" />
            </div>
            <div class="mb-3">
              <label class="form-label">Password</label>
              <input id="password" type="password" class="form-control" />
            </div>
            <div class="mb-3">
              <label class="form-label">Address</label>
              <input id="address" class="form-control" />
            </div>
          </div>

          <div class="modal-footer">
            <button class="btn btn-secondary" data-bs-dismiss="modal">
              Cancel
            </button>
            <button
              class="btn btn-primary"
              onclick="submitUser()"
              style="background-color: #49749b"
            >
              Submit
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- User Profile Modal -->
    <div class="modal fade" id="userDetailModal" tabindex="-1">
      <div class="modal-dialog modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header" style="background: #2d5983; color: white">
            <h5 class="modal-title">User Profile</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>

          <div class="modal-body" id="userDetailContent"></div>

          <div class="modal-footer">
            <button
              class="btn btn-primary"
              data-bs-dismiss="modal"
              style="background: #2d5983; color: white"
            >
              Close
            </button>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      fetch("http://localhost:3001/users")
        .then((res) => res.json())
        .then((data) => {
          if (!data.success) return alert("Failed to load users");

          const rows = data.users || [];
          const headerRow = document.getElementById("userHeaderRow");
          const tableBody = document.getElementById("userTableBody");

          headerRow.innerHTML = "";
          tableBody.innerHTML = "";

          if (rows.length === 0) {
            headerRow.innerHTML = "<th>No users</th>";
            return;
          }

          const headers = Object.keys(rows[0]);
          headers.forEach((h) => {
            const th = document.createElement("th");
            th.textContent = h + ":";
            th.style.color = "white";
            th.style.background = "#2d5983";
            headerRow.appendChild(th);
          });

          const actionTh = document.createElement("th");
          actionTh.textContent = "View";
          actionTh.style.color = "white";
          actionTh.style.background = "#2d5983";
          headerRow.appendChild(actionTh);

          const idKey =
            headers.find((h) => h.toLowerCase().includes("id")) || headers[0];

          rows.forEach((row) => {
            const tr = document.createElement("tr");

            headers.forEach((h) => {
              const td = document.createElement("td");
              td.textContent = row[h];
              tr.appendChild(td);
            });

            const actionTd = document.createElement("td");
            const btn = document.createElement("button");
            btn.type = "button";
            btn.className = "btn btn-link p-0 btn-eye";
            btn.title = "View profile";
            btn.innerHTML = `<i class="bi bi-eye fs-5" style="color: #499aac;"></i>`;

            btn.addEventListener("click", (ev) => {
              ev.stopPropagation();
              const content = document.getElementById("userDetailContent");
              content.innerHTML = "<p>Loading user data...</p>";
              const userModalEl = document.getElementById("userDetailModal");
              const bsModal = new bootstrap.Modal(userModalEl);
              bsModal.show();

              const id = row[idKey];
              openUserProfile(id);
            });

            actionTd.appendChild(btn);
            tr.appendChild(actionTd);
            tableBody.appendChild(tr);
          });
        })
        .catch((err) => {
          console.error("Error loading users:", err);
          alert("Error loading users");
        });

      function submitUser() {
        const data = {
          FULLNAME: document.getElementById("fullname").value,
          EMAIL: document.getElementById("email").value,
          PASSWORD: document.getElementById("password").value,
          ADDRESS: document.getElementById("address").value,
        };

        fetch("http://localhost:3001/addUser", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data),
        })
          .then((r) => r.json())
          .then((res) => {
            if (res.success) {
              alert("User Added");
              location.reload();
            } else {
              alert(res.message);
            }
          });
      }

      async function openUserProfile(id) {
        try {
          const res = await fetch(
            `http://localhost:3001/user-profile/${encodeURIComponent(id)}`
          );
          const data = await res.json();

          if (!data.success) return alert(data.message);

          showUserModal(data.user);
        } catch (err) {
          console.error(err);
          alert("Error fetching user profile");
        }
      }

      function showUserModal(user) {
        const container = document.getElementById("userDetailContent");
        container.innerHTML = "";

        if (!user) {
          container.innerHTML = "<p>No data available.</p>";
          return;
        }

        for (const [key, value] of Object.entries(user)) {
          if (key.toLowerCase().includes("id")) continue;

          container.innerHTML += `
            <div class="mb-3">
              <label class="form-label fw-bold profile-label">${key}:</label>
              <input class="form-control profile-input" value="${value}" readonly>
            </div>
          `;
        }
      }
    </script>
  </body>
</html>
